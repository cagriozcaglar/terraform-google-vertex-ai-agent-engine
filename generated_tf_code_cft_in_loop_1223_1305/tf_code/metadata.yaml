#
# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-vertex-ai-search-and-conversation
  annotations:
    config.kubernetes.io/local-config: "true"
spec:
  info:
    title: Vertex AI Search and Conversation
    source:
      type: git
      location: https://github.com/GoogleCloudPlatform/terraform-google-vertex-ai-search-and-conversation.git
    version: 0.1.0
    actuationTool:
      type: Terraform
      version:
        - ">= 1.3"
    description:
      tagline: A Terraform module to deploy Datastores and Engines for Vertex AI Search and Conversation.
      detailed: This module handles the deployment of Google Cloud Vertex AI Search and Conversation resources, including Data Stores, Chat Engines, and Schemas for structured data. It supports both search and chat solution types.
    icon: https://cloud.google.com/static/images/cloud/products/icons/2x/vertex-ai-search-and-conversation-256.png
    documentations:
      - title: Vertex AI Search and Conversation
        url: https://cloud.google.com/generative-ai-app-builder/docs/introduction
  content:
    examples:
      - name: chat_app_unstructured_data
        title: Chat App with Unstructured Data
        description: An example of deploying a chat application using a datastore with unstructured documents.
      - name: search_app_structured_data
        title: Search App with Structured Data
        description: An example of deploying a search application with a structured data datastore and a custom schema.
      - name: minimal_search_app
        title: Minimal Search App
        description: A basic example of a search-only application.
  interfaces:
    variables:
      - name: chat_engine_config
        description: Configuration for a chat app. Required when `solution_type` is `SOLUTION_TYPE_CHAT`.
        type: object
        default: null
        required: false
      - name: content_config
        description: The content configuration of the datastore. Valid values are `CONTENT_CONFIG_UNSTRUCTURED_DOCUMENT` or `CONTENT_CONFIG_STRUCTURED_DATA`.
        type: string
        default: null
        required: false
      - name: data_store_schema_id
        description: The unique ID for the schema. Used when `content_config` is `CONTENT_CONFIG_STRUCTURED_DATA`. Defaults to `default-schema`.
        type: string
        default: "default-schema"
        required: false
      - name: data_store_schema_json
        description: The JSON schema for the datastore as a string. Required when `content_config` is `CONTENT_CONFIG_STRUCTURED_DATA`.
        type: string
        default: null
        required: false
      - name: datastore_display_name
        description: The display name of the datastore.
        type: string
        required: true
      - name: datastore_id
        description: A unique identifier for the datastore. Must be alphanumeric and may contain hyphens, and be up to 63 characters long.
        type: string
        required: true
      - name: display_name
        description: The base display name for the Vertex AI Engine. A suffix of '-engine' will be added automatically. Required when solution_type is 'SOLUTION_TYPE_CHAT'.
        type: string
        default: null
        required: false
      - name: engine_id
        description: A unique identifier for the engine (App). Required when solution_type is 'SOLUTION_TYPE_CHAT'. Must be alphanumeric and may contain hyphens, and be up to 63 characters long.
        type: string
        default: null
        required: false
      - name: industry_vertical
        description: The industry vertical that the datastore registers. For example, `GENERIC`, `MEDIA`, `HEALTHCARE`.
        type: string
        default: GENERIC
        required: false
      - name: location
        description: The location for the Vertex AI Search and Conversation resources. Can be `global`, `us`, or `eu`.
        type: string
        default: global
        required: false
      - name: project_id
        description: The ID of the project in which to create the Vertex AI Search and Conversation resources. If not provided, the provider project is used.
        type: string
        required: true
      - name: search_engine_config
        description: DEPRECATED: Configuration for a search app. This is no longer supported by the underlying provider. Please set to null.
        type: object
        default: null
        required: false
      - name: solution_type
        description: The solution type for the app. Valid values are `SOLUTION_TYPE_SEARCH` or `SOLUTION_TYPE_CHAT`.
        type: string
        default: null
        required: false
    variableGroups:
      - name: General Settings
        description: Basic configuration for the deployment.
        variables:
          - project_id
          - location
      - name: Datastore Configuration
        description: Core settings for the Data Store resource.
        variables:
          - datastore_id
          - datastore_display_name
          - solution_type
          - content_config
          - industry_vertical
      - name: Chat Engine Configuration
        description: Settings specific to chat solutions. These are required only when solution_type is 'SOLUTION_TYPE_CHAT'.
        variables:
          - engine_id
          - display_name
          - chat_engine_config
      - name: Structured Data Configuration
        description: Settings for structured data datastores. These are required only when content_config is 'CONTENT_CONFIG_STRUCTURED_DATA'.
        variables:
          - data_store_schema_id
          - data_store_schema_json
    outputs:
      - name: data_store_name
        description: The full resource name of the created Datastore.
      - name: datastore_id
        description: The unique ID of the created datastore.
      - name: engine_id
        description: The unique ID of the created Engine. This is only applicable for SOLUTION_TYPE_CHAT.
      - name: engine_name
        description: The full resource name of the created Engine. This is only applicable for SOLUTION_TYPE_CHAT.
  requirements:
    roles:
      - level: project
        roles:
          - roles/discoveryengine.admin
    services:
      - discoveryengine.googleapis.com
